<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>WT Admin | Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    <style>
        :root { --main: #2d0054; --gold: #ffd700; }
        body { font-family: 'Kanit', sans-serif; margin: 0; display: flex; background: #f4f7f6; }
        .sidebar { width: 240px; background: var(--main); color: white; height: 100vh; position: fixed; padding: 30px; box-sizing: border-box; }
        .content { margin-left: 240px; flex: 1; padding: 40px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border-left: 6px solid var(--gold); }
        input, select, textarea, .btn { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; font-family: 'Kanit'; box-sizing: border-box; }
        .btn { background: var(--main); color: white; border: none; font-weight: 600; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; font-size: 0.85rem; }
        .del-btn { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 5px; }
        .img-preview { width: 45px; height: 45px; object-fit: cover; border-radius: 4px; margin: 2px; cursor: pointer; border: 1px solid #ddd; }
        #imgModal { display: none; position: fixed; z-index: 9999; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); text-align: center; padding-top: 50px; }
        #modalImg { max-width: 90%; max-height: 80%; border: 3px solid var(--gold); }
    </style>
</head>
<body>

<div id="imgModal" onclick="this.style.display='none'"><img id="modalImg"><br><p style="color:white;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î</p></div>

<div class="sidebar">
    <h2 style="color:var(--gold)">WT ADMIN</h2>
    <p>‚óè ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</p>
</div>

<div class="content">
    <div class="card">
        <h3>üì¢ ‡∏•‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ (‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ)</h3>
        <input type="text" id="nT" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠">
        <textarea id="nD" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"></textarea>
        <input type="file" id="nI" accept="image/*" multiple>
        <button class="btn" onclick="addNews()">‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ç‡πà‡∏≤‡∏ß</button>
        <div id="newsList" style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;"></div>
    </div>

    <div class="card">
        <h3>üìë ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ 3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô & ‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏∑‡∏ô)</h3>
        <table>
            <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™/‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏£‡∏´‡∏±‡∏™‡∏ó‡πâ‡∏≤‡∏¢</th><th>‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏∑‡∏ô ‡∏õ‡∏ä‡∏ä.</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
            <tbody id="aTable"></tbody>
        </table>
    </div>
</div>

<script>
    firebase.initializeApp({
        apiKey: "AIzaSyBDNOxOj0WZof4j6oXj5-VkG7IE2VxnzMg",
        authDomain: "wave-town-pao.firebaseapp.com",
        databaseURL: "https://wave-town-pao-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "wave-town-pao",
        storageBucket: "wave-town-pao.firebasestorage.app",
        messagingSenderId: "863640463132",
        appId: "1:863640463132:web:f0d181ad0171ea96c13cd9"
    });
    const db = firebase.database();

    function viewImg(src) { document.getElementById('modalImg').src = src; document.getElementById('imgModal').style.display = 'block'; }

    async function addNews() {
        const files = document.getElementById('nI').files;
        let imgArray = [];
        if(files.length === 0) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö");
        for(let f of files) {
            const b64 = await new Promise(r => { const reader = new FileReader(); reader.onload = ev => r(ev.target.result); reader.readAsDataURL(f); });
            imgArray.push(b64);
        }
        db.ref('news').push({ title: document.getElementById('nT').value, detail: document.getElementById('nD').value, imgs: imgArray });
        alert("‡∏•‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    }

    db.ref('news').on('value', s => {
        let h = ""; const data = s.val();
        for(let k in data) h += `<div style="font-size:0.8rem; margin:5px 0;">${data[k].title} <button class="del-btn" onclick="db.ref('news/${k}').remove()">‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß</button></div>`;
        document.getElementById('newsList').innerHTML = h || "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß";
    });

    db.ref('requests').on('value', s => {
        const data = s.val(); let h = "";
        for(let k in data) {
            let pImgs = Array.isArray(data[k].imgs) ? data[k].imgs : [data[k].img];
            let imgHtml = pImgs.map(src => `<img src="${src}" class="img-preview" onclick="viewImg('${src}')">`).join('');
            
            h += `<tr>
                <td><b>${data[k].name}</b><br><small>${data[k].type}</small><br><small>${data[k].id}</small></td>
                <td><div style="display:flex; flex-wrap:wrap; max-width:140px;">${imgHtml}</div></td>
                <td>
                    <select id="s-${k}" style="font-size:10px;">
                        <option value="üü† ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" ${data[k].status.includes('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')?'selected':''}>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                        <option value="üîµ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${data[k].status.includes('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')?'selected':''}>‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                        <option value="üü¢ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ${data[k].status.includes('‡πÄ‡∏™‡∏£‡πá‡∏à')?'selected':''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                    </select>
                    <input type="text" id="c-${k}" value="${data[k].code||''}" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ó‡πâ‡∏≤‡∏¢" style="width:60px;">
                </td>
                <td><input type="file" id="f-${k}" style="font-size:10px;"></td>
                <td>
                    <button class="btn" style="padding:5px;" onclick="updateReq('${k}')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button class="del-btn" onclick="if(confirm('‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£?')) db.ref('requests/${k}').remove()">‡∏•‡∏ö</button>
                </td>
            </tr>`;
        }
        document.getElementById('aTable').innerHTML = h;
    });

    async function updateReq(id) {
        const status = document.getElementById('s-'+id).value;
        const code = document.getElementById('c-'+id).value;
        const fileInp = document.getElementById('f-'+id).files[0];
        
        let updateData = { status, code };
        
        if(fileInp) {
            const b64 = await new Promise(r => { const reader = new FileReader(); reader.onload = ev => r(ev.target.result); reader.readAsDataURL(fileInp); });
            updateData.returnFile = b64;
        }
        
        db.ref('requests/'+id).update(updateData).then(() => alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"));
    }
</script>
</body>
</html>
