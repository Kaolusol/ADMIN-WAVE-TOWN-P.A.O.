<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>WT Admin | Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database-compat.js"></script>
    <style>
        :root { --main: #2d0054; --gold: #ffd700; --blue: #3498db; --green: #27ae60; }
        body { font-family: 'Kanit', sans-serif; margin: 0; display: flex; background: #f4f7f6; }
        .sidebar { width: 240px; background: var(--main); color: white; height: 100vh; position: fixed; padding: 30px; box-sizing: border-box; }
        .content { margin-left: 240px; flex: 1; padding: 40px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border-left: 6px solid var(--gold); }
        input, select, textarea, .btn { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; font-family: 'Kanit'; box-sizing: border-box; }
        .btn { background: var(--main); color: white; border: none; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn:hover { opacity: 0.8; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; font-size: 0.85rem; }
        th { background: #f8f9fa; color: var(--main); }
        .img-preview { width: 50px; height: 50px; object-fit: cover; border-radius: 6px; margin: 2px; cursor: pointer; border: 2px solid #eee; }
        #imgModal { display: none; position: fixed; z-index: 9999; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); text-align: center; padding-top: 30px; }
        #modalImg { max-width: 90%; max-height: 80%; border: 3px solid var(--gold); border-radius: 10px; }
        .step-label { font-size: 0.7rem; color: #666; font-weight: bold; display: block; margin-top: 5px; }
    </style>
</head>
<body>

<div id="imgModal" onclick="this.style.display='none'">
    <img id="modalImg">
    <div style="color:white; margin-top:15px;">
        <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î</p>
        <a id="dlLink" download="citizen_doc.png" style="color:var(--gold); text-decoration:none; font-size:1.2rem; background:rgba(255,255,255,0.1); padding:10px 20px; border-radius:30px;">üíæ ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ</a>
    </div>
</div>

<div class="sidebar">
    <h2 style="color:var(--gold)">WT ADMIN</h2>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</p>
    <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1);">
    <small>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô:<br>1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö/‡πÄ‡∏ã‡∏ü‡∏£‡∏π‡∏õ<br>2. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥"<br>3. ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ó‡πâ‡∏≤‡∏¢<br>4. ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô & ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏∑‡∏ô</small>
</div>

<div class="content">
    <div class="card" style="border-left-color: #3498db;">
        <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</h3>
        <input type="text" id="setTicker" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ß‡∏¥‡πà‡∏á">
        <input type="text" id="setVision" placeholder="‡∏ß‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏±‡∏®‡∏ô‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö">
        <button class="btn" style="background:#3498db;" onclick="saveSets()">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div class="card">
        <h3>üì¢ ‡∏•‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ (Facebook Style)</h3>
        <input type="text" id="nT" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß">
        <textarea id="nD" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πà‡∏≤‡∏ß"></textarea>
        <input type="file" id="nI" accept="image/*" multiple>
        <button class="btn" onclick="addNews()">‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Ç‡πà‡∏≤‡∏ß</button>
        <div id="newsList" style="margin-top:10px;"></div>
    </div>

    <div class="card">
        <h3>üìë ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ã‡∏ü‡∏£‡∏π‡∏õ -> ‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -> ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô)</h3>
        <table>
            <thead>
                <tr>
                    <th>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</th>
                    <th>‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏ã‡∏ü)</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏£‡∏´‡∏±‡∏™</th>
                    <th>‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="aTable"></tbody>
        </table>
    </div>
</div>

<script>
    firebase.initializeApp({
        apiKey: "AIzaSyBDNOxOj0WZof4j6oXj5-VkG7IE2VxnzMg",
        authDomain: "wave-town-pao.firebaseapp.com",
        databaseURL: "https://wave-town-pao-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "wave-town-pao",
        storageBucket: "wave-town-pao.firebasestorage.app",
        messagingSenderId: "863640463132",
        appId: "1:863640463132:web:f0d181ad0171ea96c13cd9"
    });
    const db = firebase.database();

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
    function saveSets() {
        db.ref('settings').set({
            ticker: document.getElementById('setTicker').value,
            vision: document.getElementById('setVision').value
        }).then(() => alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡∏ß‡∏¥‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏™‡∏±‡∏¢‡∏ó‡∏±‡∏®‡∏ô‡πå‡πÅ‡∏•‡πâ‡∏ß!"));
    }
    // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å
    db.ref('settings').once('value', s => {
        const v = s.val(); if(v){ 
            document.getElementById('setTicker').value = v.ticker; 
            document.getElementById('setVision').value = v.vision;
        }
    });

    function viewImg(src) { 
        document.getElementById('modalImg').src = src; 
        document.getElementById('dlLink').href = src;
        document.getElementById('imgModal').style.display = 'block'; 
    }

    async function addNews() {
        const files = document.getElementById('nI').files;
        let imgArray = [];
        if(files.length === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û");
        for(let f of files) {
            const b64 = await new Promise(r => { const reader = new FileReader(); reader.onload = ev => r(ev.target.result); reader.readAsDataURL(f); });
            imgArray.push(b64);
        }
        db.ref('news').push({ title: document.getElementById('nT').value, detail: document.getElementById('nD').value, imgs: imgArray });
        alert("‡∏•‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
    }

    db.ref('news').on('value', s => {
        let h = ""; const data = s.val();
        for(let k in data) h += `<div style="font-size:0.8rem; border-bottom:1px solid #eee; padding:5px 0;">${data[k].title} <button onclick="db.ref('news/${k}').remove()" style="color:red; background:none; border:none; cursor:pointer;">[‡∏•‡∏ö‡∏Ç‡πà‡∏≤‡∏ß]</button></div>`;
        document.getElementById('newsList').innerHTML = h;
    });

    db.ref('requests').on('value', s => {
        const data = s.val(); let h = "";
        for(let k in data) {
            let pImgs = Array.isArray(data[k].imgs) ? data[k].imgs : [data[k].img];
            let imgHtml = pImgs.map(src => `<img src="${src}" class="img-preview" onclick="viewImg('${src}')">`).join('');
            
            h += `<tr>
                <td><b>${data[k].name}</b><br><span style="color:var(--blue)">${data[k].type}</span><br><small>ID: ${data[k].id}</small></td>
                <td><div style="display:flex; flex-wrap:wrap; width:120px;">${imgHtml}</div></td>
                <td>
                    <select id="s-${k}" style="font-size:0.8rem;">
                        <option value="üü† ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" ${data[k].status.includes('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö')?'selected':''}>üü† ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                        <option value="üîµ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" ${data[k].status.includes('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥')?'selected':''}>üîµ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                        <option value="üü¢ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô" ${data[k].status.includes('‡πÄ‡∏™‡∏£‡πá‡∏à')?'selected':''}>üü¢ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                    </select>
                    <input type="text" id="c-${k}" value="${data[k].code||''}" placeholder="‡πÄ‡∏•‡∏Ç‡∏£‡∏´‡∏±‡∏™‡∏ó‡πâ‡∏≤‡∏¢" style="height:30px; font-size:0.8rem;">
                </td>
                <td><input type="file" id="f-${k}" style="font-size:0.7rem;"></td>
                <td>
                    <button class="btn" style="padding:8px; background:var(--green);" onclick="updateReq('${k}')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button onclick="if(confirm('‡∏•‡∏ö‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á?')) db.ref('requests/${k}').remove()" style="background:none; border:none; color:red; cursor:pointer; font-size:0.7rem; margin-top:5px; display:block;">‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á</button>
                </td>
            </tr>`;
        }
        document.getElementById('aTable').innerHTML = h;
    });

    async function updateReq(id) {
        const status = document.getElementById('s-'+id).value;
        const code = document.getElementById('c-'+id).value;
        const fileInp = document.getElementById('f-'+id).files[0];
        let updateData = { status, code };
        if(status.includes('‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') && !fileInp) {
            const snap = await db.ref('requests/'+id).once('value');
            if(!snap.val().returnFile) return alert("‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏ö‡∏á‡∏≤‡∏ô");
        }
        if(fileInp) {
            const b64 = await new Promise(r => { const reader = new FileReader(); reader.onload = ev => r(ev.target.result); reader.readAsDataURL(fileInp); });
            updateData.returnFile = b64;
        }
        db.ref('requests/'+id).update(updateData).then(() => alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"));
    }
</script>
</body>
</html>
